---
title: 一言不合就爬虫
author: ''
date: '2019-05-22'
slug: 一言不合就爬虫
categories:
  - R
tags: []
---

#跟着教程爬爬爬
```{r}

library("rvest")

library("dplyr")

library("stringr")
ind <-c(0,25,50,75,100,125,150,175,200,225)
book_inf <-data.frame()
for (i in 1:length(ind))
web<-read_html(str_c("https://book.douban.com/top250?start=",ind[i]),encoding="UTF-8")
p <-web%>%html_nodes("p.pl")%>%html_text()
q <-web%>%html_nodes(".pl2 a")%>%html_text()

#爬取图书的rate

r <-web%>%html_nodes(".rating_nums")%>%html_text()

#消除q中的空格

q <-str_replace_all(q," ","")

q <-str_replace_all(q,"\n","")

#赋值图书书名和评分

name <- q

rate <- r

#对p进行处理

#提取作者名字

p1 <-str_split_fixed(p,"/",2)

author <- p1[,1];

#提取翻译者名字

p2 <-str_split_fixed(p1[,2],"/",2)

a <-str_detect(p2[,1],"出版")

b <- str_detect(p2[,1],"书店")

interpre <-p2[,1]

interpre[a|b] <-"NA"

#提取出版商

p3 <-str_split_fixed(p2[,2],"/",2)

publisher <-p3[,1]

publisher[a] <-p2[a,1]

publisher[b] <-p2[b,1]

#提取出版时间

p4 <-str_split_fixed(p3[,2],"/",2)

publish_time <-p4[,1]

publish_time[a]<- p3[a,1]

publish_time[b]<- p3[b,1]

publish_time <- str_replace(publish_time,"年","-")

publish_time <- str_replace(publish_time,"月","-")

#提取价格

p5 <-str_split_fixed(p4[,2],"/",2)

price <- p5[,1]

price[a] <-p4[a,1]

price[b] <-p4[b,1]

#创建数据框存储以上信息

book <-data_frame(name,rate,author,interpre,publisher,publish_time,price)

book_inf <-rbind(book_inf,book)

#对于少数不合规则的数据进行处理

book_inf[52,5:7]<- book_inf[52,4:6]

book_inf[52,4] <-"NA"

book_inf[136,5:7]<- book_inf[136,4:6]

book_inf[136,4]<- "NA"

#根据出版社进行分析

a <-summarise(group_by(book_inf,publisher),count = n())

arrange(a,desc(count))

#根据出版时间进行分析

b<-str_split_fixed(book_inf$publish_time,"-",2)

b <- b[,1]

table(b)

```

